export const metadata = {
  title: 'Next.js Guide',
  label: 'Next.js',
  description:
    'The renoun toolkit enhances the Next.js framework with powerful content and documentation features.',
  tags: ['next', 'next.js', 'framework'],
}

The renoun toolkit provides file system querying, [syntax highlighting](/components/code-block), and [api references](/components/api-reference), making it easier to create accurate and engaging content for blogs, documentation, and design systems powered by Next.js.

## Install

To use renoun with Next.js, start with an existing or new Next.js project. If you don't have a project yet, you can create one using the Next.js create command:

```bash
npx create-next-app@latest
```

## Setup

Modify the `next` scripts located in the project's `package.json` file to use the `renoun` CLI. This will ensure that the renoun process starts before your Next.js server:

```json
{
  "scripts": {
    "dev": "renoun next dev",
    "build": "renoun next build"
  }
}
```

<Note>

This command is necessary to enable renoun features in your Next.js project.
The `renoun` CLI starts a WebSocket server that communicates with components
and utilities in your project to provide accurate and performant code analysis and syntax highlighting.

</Note>

## MDX (Optional)

To enable writing MDX content in your Next.js application, we will use the [`@next/mdx`](https://github.com/vercel/next.js/tree/canary/packages/next-mdx) package. This package allows you to author MDX content in your Next.js project. Additionally, you can use the pre-configured `remarkPlugins` and `rehypePlugins` from `renoun/mdx`.

<Note>

This step is optional and only necessary if you plan to use MDX in your
project. Additionaly, you can skip adding the `renoun/mdx` package if you
want to configure your own MDX plugins.

</Note>

First, install the Next.js MDX plugin:

<PackageInstall packages={['@next/mdx']} />

Now, add the plugin to your `next.config` file while optionally including the pre-configured `remarkPlugins` and `rehypePlugins` from `renoun/mdx`:

```js
import createMDXPlugin from '@next/mdx'
import { remarkPlugins, rehypePlugins } from 'renoun/mdx'

const withMDX = createMDXPlugin({
  extension: /\.mdx?$/,
  options: {
    remarkPlugins,
    rehypePlugins,
  },
})

export default withMDX({
  pageExtensions: ['js', 'jsx', 'ts', 'tsx', 'md', 'mdx'],
})
```

## MDX Code Blocks

Use the `MDXComponents` export to override the `pre` and `code` components in your project's `mdx-components.tsx` file:

```tsx filename="02.mdx-components.tsx"
import { MDXComponents } from 'renoun/components'

export function useMDXComponents() {
  return MDXComponents
}
```

This forwards the meta information added from the `@renoun/mdx` rehype plugin to the `CodeBlock` component.

## Querying the File System

The `Directory` utility in renoun lets you query and load files from your project’s file system. For example, to create a list of blog posts or documentation pages we can query all MDX files in a directory:

```tsx
import { Directory } from 'renoun/file-system'

const posts = new Directory({
  path: 'posts',
  include: '*.mdx',
  loaders: {
    mdx: (path) => import(`@/posts/${path}.mdx`),
  },
})
```

Next, we can use the `Directory` instance to render the contents of our MDX files:

```tsx
import { Directory } from 'renoun/file-system'

const posts = new Directory({
  path: 'posts',
  include: '*.mdx',
  loaders: {
    mdx: (path) => import(`@/posts/${path}.mdx`),
  },
})

export default async function Page({
  params,
}: {
  params: Promise<{ slug: string }>
}) {
  const slug = (await params).slug
  const post = await posts.getFile(slug, 'mdx')

  if (!post) {
    return <div>Post not found</div>
  }

  const Content = await post.getExportValueOrThrow('default')

  return <Content />
}
```

This will create a collection of all MDX files in the `posts` directory and render them based on the provided slug.

### Generating Links

A directory entry’s `getPath` method can generate a route path for each entry. For example, to generate a link to each post, you can iterate over the entries and use the entry’s `getPath` method:

```tsx
import { Directory } from 'renoun/file-system'
import Link from 'next/link'

const posts = new Directory({
  path: 'posts',
  include: '*.mdx',
  loaders: {
    mdx: (path) => import(`@/posts/${path}.mdx`),
  },
})

export default async function Page() {
  const allPosts = await posts.getEntries()

  return (
    <>
      <h1>Blog</h1>
      <ul>
        {allPosts.map(async (post) => {
          const path = post.getPath()

          return (
            <li key={path}>
              <Link href={path}>{post.getTitle()}</Link>
            </li>
          )
        })}
      </ul>
    </>
  )
}
```

Collections are not limited to MDX files and can be used with _any file type_.

## Start

Now you can start your Next.js server with renoun enabled:

```bash
npm run dev
```

Congratulations, you've successfully set up renoun with Next.js! You can now query other [file system](/utilities/file-system) entries or use one of the many [components](/components) available to enhance your content and documentation.
